{% extends 'base.html' %}
{% block content %}
<!-- js for the dynamic genre form -->
<script src="{{ url_for('static', filename='js/genre_form.js') }}"></script>

<div class="container mt-4">
  <!-- Top header + button -->
  <div class="mb-4">
    <h2 class="mb-1">Manage Genres</h2>
    <p class="text-muted">
      Use this page to <strong>view, create, edit, or delete genres</strong>. Genres help categorise book listings
      throughout the site.
    </p>
    <a href="#createGenreForm" class="btn btn-outline-primary">+ Add New Genre</a>
  </div>


  <div class="mb-5">
    <h3>{% if genres|length > 0 %} Current Genres {% else%} No genres created {% endif %}</h3>

    <div class="d-flex flex-wrap gap-3">
      {% for genre in genres %}
      <div class="card genre-card" style="width: 180px;">
        {% if genre.image %}
        <img src="{{ url_for('static', filename=genre.image) }}" alt="{{ genre.name }}">
        {% else %}
        <img src="{{ url_for('static', filename='images/default.png') }}" alt="{{ genre.name }}">
        {% endif %}

        <div class="card-body p-2 text-center">
          <h5 class="card-title mb-0">{{ genre.name | capitalize }}</h5>



          <div class="d-flex gap-2 align-items-center justify-content-center">
            <div class="d-flex align-items-center">
              <button class="btn btn-outline-secondary btn-sm edit-btn" data-id="{{genre.genre_id}}"
                data-name="{{genre.name}}" data-image="{{genre.image}}">
                Edit
              </button>
            </div>
            <div class="d-flex align-items-center">
              <form action="{{url_for('admin.delete')}}" method='POST'
                onsubmit="return confirm('Are you sure you want to delete this genre? All listings using this genre will have their genre set to None. This will not affect the listings themselves. This action cannot be undone.');"
                style="margin:0; display: inline-flex; align-items: center;">
                <input type="hidden" name="id" value={{genre.genre_id}}>
                <input type="hidden" name="model" value="genre">
                <button type="submit" class="btn btn-danger btn-sm">
                  Delete
                </button>
              </form>
            </div>
          </div>


        </div>
      </div>
      {% endfor %}
    </div>
  </div>


  <div id="createGenreForm" class="card mb-4 shadow-sm" style="max-width: 600px;">
    <div class="card-body">
      <h5 class="card-title" id="genreFormHeading">Create a New Genre</h5>
      <form id="genreForm" action="{{ url_for('admin.create_genre') }}" method="POST"
        data-edit-url="{{ url_for('admin.edit_genre') }}" data-create-url="{{ url_for('admin.create_genre') }}">

        <input type="hidden" id="genre_id" name="id">
        <div class="mb-3">
          <label for="name" class="form-label">Genre Name</label>
          <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <label class="form-label">Select an Image:</label>
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-3">
          {% for image in genre_images %}
          <div class="col text-center">
            <label style="cursor: pointer;">
              <input type="radio" name="image" value="{{ image }}" class="edit-genre-radio">
              <img src="{{ url_for('static', filename=image) }}" class="img-fluid rounded-start"
                style="height: 140px; object-fit: cover;">
            </label>
          </div>
          {% endfor %}
        </div>

        <button type="submit" id="genreFormSubmit" class="btn btn-primary mt-3">Add Genre</button>
        <button type="button" id="cancelEditBtn" class="btn btn-secondary mt-3 ms-2" style="display:none;">
          Cancel
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}